---
milestone: v0.1
audited: 2026-02-26T07:30:00Z
status: gaps_found
scores:
  requirements: 13/13
  phases_verified: 27/34
  integration: 12/12
  flows: 9/9
gaps:
  requirements:
    - id: "VCGEN-06"
      status: "partial"
      phase: "29-to-fix-the-identified-gaps"
      claimed_by_plans: ["29-01-PLAN.md", "29-05-PLAN.md"]
      completed_by_plans: ["29-05-SUMMARY.md"]
      verification_status: "passed (struct field mutation), partial (SetDiscriminant VC deferred)"
      evidence: "ir::Statement::SetDiscriminant not in ir.rs; vcgen_06_set_discriminant_assertion is #[ignore]; VCGen treats SetDiscriminant as no-op (does not panic but does not emit VC)"
    - id: "MIRCONV-02"
      status: "partial"
      phase: "29-to-fix-the-identified-gaps"
      claimed_by_plans: ["29-03-PLAN.md"]
      completed_by_plans: ["29-03-SUMMARY.md"]
      verification_status: "passed (AggregateKind::Adt/Closure and ir::Assume), partial (ir::SetDiscriminant deferred)"
      evidence: "SetDiscriminant IR variant not implemented; explicitly documented as deferred in Phase 29-01 SUMMARY and Phase 00 UAT"
  unverified_phases:
    - phase: "05-performance-and-polish"
      reason: "VERIFICATION.md missing — phase was executed and has 3 SUMMARY.md files but was never formally verified"
      milestone_shipped: "v0.1 (2026-02-12)"
    - phase: "06-recursive-functions"
      reason: "VERIFICATION.md missing — phase was executed and has 3 SUMMARY.md files but was never formally verified"
      milestone_shipped: "v0.2 (2026-02-14)"
    - phase: "07-closures"
      reason: "VERIFICATION.md missing — phase was executed and has 3 SUMMARY.md files but was never formally verified"
      milestone_shipped: "v0.2 (2026-02-14)"
    - phase: "08-trait-objects"
      reason: "VERIFICATION.md missing — phase was executed and has 3 SUMMARY.md files but was never formally verified"
      milestone_shipped: "v0.2 (2026-02-14)"
    - phase: "11-floating-point-verification"
      reason: "VERIFICATION.md missing — phase was executed and has 3 SUMMARY.md files but was never formally verified"
      milestone_shipped: "v0.2 (2026-02-14)"
    - phase: "13-standard-library-contracts"
      reason: "VERIFICATION.md missing — phase was executed and has 5 SUMMARY.md files but was never formally verified"
      milestone_shipped: "v0.3 (2026-02-17)"
    - phase: "17-rust-analyzer-integration"
      reason: "VERIFICATION.md missing — phase was executed and has 2 SUMMARY.md files but was never formally verified"
      milestone_shipped: "v0.3 (2026-02-17)"
  functional_gaps:
    - phase: "04-differentiation"
      verification_status: "gaps_found (score: 4/5)"
      gap: "Z3 bv2int integration incomplete — Term::Bv2Int exists but Z3 subprocess rejects 'unknown constant bv2int'. Two E2E tests (test_unbounded_int_addition_no_overflow, test_unbounded_int_sum_formula) are commented out with TODO markers. SpecInt/SpecNat via unbounded integer arithmetic is the undelivered 1/5."
      gap: "Ghost locals filtering incomplete — ghost locals are declared but VCGen filtering from executable encoding is deferred (vcgen.rs line 586 comment: 'including ghost locals - they may not be used')"
      milestone_shipped: "v0.1 (2026-02-12)"
  human_verification_pending:
    - phase: "14-incremental-verification"
      item: "Confirm 20-30x speedup benchmark delivers <1s re-verification on real codebase — benchmark passes in unit tests but E2E incremental tests require live Rust toolchain invocation and are #[ignore]d"
    - phase: "18-bv2int-optimization"
      item: "Decide: is inline help text + module-level doc comments in bv2int.rs sufficient documentation for 'when/how to use bv2int and known limitations', or is a standalone docs/bv2int.md required?"
tech_debt:
  - phase: 04-differentiation
    items:
      - "Z3 bv2int (unknown constant bv2int) — SpecInt/SpecNat unbounded arithmetic non-functional; 2 E2E tests commented out"
      - "Ghost locals filtering from executable VCs incomplete — deferred to future work"
  - phase: 10-unsafe-code-detection
    items:
      - "12 DEBTLINES in VERIFICATION (warnings about edge cases in raw pointer aliasing)"
  - phase: 15-trigger-customization
    items:
      - "9 DEBTLINES in VERIFICATION (trigger interaction edge cases noted)"
  - phase: 29-to-fix-the-identified-gaps
    items:
      - "ir::Statement::SetDiscriminant not in ir.rs — vcgen_06_set_discriminant_assertion test #[ignore]d — SetDiscriminant VCGen deferred"
  - phase: 14-incremental-verification
    items:
      - "E2E incremental tests (e2e_contract_change_transitive, e2e_fresh_flag_bypasses_cache, e2e_incremental_body_change_under_1s, e2e_no_change_all_cached) ignored due to live compiler environment requirement"
      - "bench_incremental::tests::test_full_benchmark_suite also ignored (benchmark environment)"
---

# Milestone Audit: rust-fv v0.1 (All Milestones — "Milestone UAT ✅")

**Audited:** 2026-02-26T07:30:00Z
**Phases in scope:** 34 (phases 01–29.4 + phase 00 UAT)
**Milestones covered:** v0.1 POC, v0.2 Advanced Verification, v0.3 Production Usability, v0.4 Full Rust Verification, v0.5 SMT Completeness + UAT

---

## Executive Summary

**Status: gaps_found**

All 13 tracked formal requirements (VCGEN-01..04, MIRCONV-01..02, VCGEN-05..06, DOCTEST-FIX-01, BORROW-EXPIRY-01, PROPHECY-01, VCGEN-01-FORLOOP, UAT-01) are satisfied or partially satisfied. Cross-phase integration is verified complete across 9 E2E flows and 12 key wiring points. However, 7 of 34 phases are missing formal VERIFICATION.md files (all from early shipped milestones v0.1–v0.3), and Phase 04 has a documented functional gap in Z3 bv2int integration.

**Live test suite:** 3,148 tests pass, 0 failures (workspace-wide as of 2026-02-26)

---

## Phase Verification Status

| Phase | Name | Status | Score |
|-------|------|--------|-------|
| 00 | Milestone UAT | ✓ passed | 5/5 |
| 01 | Soundness Foundation | ✓ passed | 5/5 |
| 02 | Table-Stakes Completion | ✓ passed | 5/5 |
| 03 | Modular Verification | ✓ passed | 9/9 |
| 04 | Differentiation | ✗ gaps_found | 4/5 |
| 05 | Performance and Polish | ○ **unverified** | — |
| 06 | Recursive Functions | ○ **unverified** | — |
| 07 | Closures | ○ **unverified** | — |
| 08 | Trait Objects | ○ **unverified** | — |
| 09 | Lifetime Reasoning | ✓ passed | 5/5 |
| 10 | Unsafe Code Detection | ✓ passed | 7/7 |
| 11 | Floating-Point Verification | ○ **unverified** | — |
| 12 | Bounded Concurrency | ✓ passed | 7/7 |
| 13 | Standard Library Contracts | ○ **unverified** | — |
| 14 | Incremental Verification | ⚠ human_needed | 5/5 |
| 15 | Trigger Customization | ✓ passed | 5/5 |
| 16 | VSCode Extension | ✓ passed | 5/5 |
| 17 | rust-analyzer Integration | ○ **unverified** | — |
| 18 | bv2int Optimization | ⚠ human_needed | 4/5 |
| 19 | Counterexample Generation | ✓ passed | 4/4 |
| 20 | Separation Logic | ✓ passed | 7/7 |
| 21 | Weak Memory Models | ✓ passed | 14/14 |
| 22 | Higher-Order Closures | ✓ passed | 12/12 |
| 23 | Async/Await | ✓ passed | 13/13 |
| 24 | SEP-04 Ghost Predicate Wiring | ✓ passed | 4/4 |
| 25 | VSCode Counterexample v2 | ✓ passed | 5/5 |
| 26 | WMM-03 Race Detection Fix | ✓ passed | 5/5 |
| 27 | Async CEX IDE Fidelity | ✓ passed | 6/6 |
| 28 | SMT VCGen Completeness | ✓ passed | 10/10 |
| 29 | Fix Identified SMT Gaps | ✓ passed | 4/4 |
| 29.1 | For-loop Iterator Range VCGen | ✓ passed | 15/15 |
| 29.2 | Prophecy Encoding Mutable Refs | ✓ passed | 5/5 |
| 29.3 | Borrow Conflict Detection | ✓ passed | 4/4 |
| 29.4 | stdlib_contracts Doc Test Fixes | ✓ passed | 5/5 |

**Verified:** 27/34 phases | **Unverified:** 7/34 (all from v0.1–v0.3 shipped milestones)

---

## Requirements Coverage (3-Source Cross-Reference)

| REQ-ID | Description | Phase | VERIFICATION.md | SUMMARY frontmatter | Integration | Final Status |
|--------|------------|-------|----------------|---------------------|-------------|-------------|
| VCGEN-01 | Array index bounds VCs and slice length encoding | 28 | ✓ passed | ✓ listed | ✓ wired | **satisfied** |
| VCGEN-02 | Discriminant binding for match/if-let/while-let | 28 | ✓ passed | ✓ listed | ✓ wired | **satisfied** |
| VCGEN-03 | Numeric as-cast encoding | 28 | ✓ passed | ✓ listed | ✓ wired | **satisfied** |
| VCGEN-04 | Generic where-clause premises as SMT assumptions | 28 | ✓ passed | ✓ listed | ✓ wired | **satisfied** |
| MIRCONV-01 | CastKind preservation + TyKind::Param→Generic | 29 | ✓ passed | ✓ listed | ✓ wired | **satisfied** |
| MIRCONV-02 | AggregateKind::Adt/Closure + ir::SetDiscriminant/Assume | 29 | ✓ passed (partial) | ✓ listed | ⚠ partial | **partial** |
| VCGEN-05 | float-to-int SMT encoding fix (fp.to_sbv/fp.to_ubv RTZ) | 29 | ✓ passed | ✓ listed | ✓ wired | **satisfied** |
| VCGEN-06 | Projected LHS functional record update + Downcast narrowing | 29 | ✓ passed (partial) | ✓ listed | ⚠ partial | **partial** |
| DOCTEST-FIX-01 | Fix 26 suppressed doc tests in stdlib_contracts | 29.4 | ✓ passed | — | ✓ wired | **satisfied** |
| BORROW-EXPIRY-01 | Implement generate_expiry_vcs() | 29.3 | ✓ passed | — | ✓ wired | **satisfied** |
| PROPHECY-01 | Fix test_prophecy_basic for mutable ref postconditions | 29.2 | ✓ passed | — | ✓ wired | **satisfied** |
| VCGEN-01-FORLOOP | For-loop Iterator Range VCGen | 29.1 | ✓ passed | — | ✓ wired | **satisfied** |
| UAT-01 | v0.4+v0.5 Milestone UAT — 22/22 tests pass | 00 | ✓ passed | ✓ listed | ✓ wired | **satisfied** |

**Satisfied:** 11/13 | **Partial:** 2/13 | **Unsatisfied/Orphaned:** 0/13

### Orphan Detection
No orphaned requirements found. All 13 REQ-IDs appear in at least one VERIFICATION.md file.

---

## Integration Check Results

**Flows verified:** 9/9 complete | **Broken flows:** 0 | **Missing connections:** 0

| Flow | Status | Notes |
|------|--------|-------|
| MIR → IR → VCGen → SMT-LIB2 → Z3 → result | ✓ COMPLETE | Full pipeline wired, callbacks→mir_converter→parallel→vcgen→solver |
| Z3 model → typed values → Ariadne/VSCode display | ✓ COMPLETE | cex_render.rs exported and called from parallel.rs |
| StdlibContractRegistry → VCGen inter-procedural | ✓ COMPLETE | load_default_contracts → merge_into → Arc<ContractDatabase> → generate_vcs_with_db |
| ghost_pred_db → VerificationTask → generate_vcs_with_db | ✓ COMPLETE | 4-hop chain confirmed; compile-time sentinel test guards wiring |
| CoroutineInfo → state_invariant → CEX extraction → IDE | ✓ COMPLETE | async_vcgen::generate_async_vcs wired from vcgen.rs line 784 |
| bv2int eligibility → QF_LIA encoding → differential test | ✓ COMPLETE | is_bv2int_eligible exported and called from callbacks.rs |
| IteratorKind IR → AUFLIA/QF_LIA VCs | ✓ COMPLETE | for_loop_vcgen::generate_for_loop_vcs wired at vcgen.rs line 739 |
| *_1 ensures context → _1_prophecy SMT | ✓ COMPLETE | parse_spec_expr_postcondition_with_db → parse_spec_postcondition |
| BorrowInfo → generate_expiry_vcs → BorrowValidity VCs | ✓ COMPLETE | borrow_conflict::generate_expiry_vcs called at vcgen.rs line 493 |

---

## Critical Gaps

### 1. Phase 04 — Z3 bv2int functional gap (from v0.1, shipped 2026-02-12)
- **What:** Z3 subprocess rejects `bv2int` as "unknown constant" — `Term::Bv2Int` infrastructure exists in `crates/smtlib/src/term.rs` but Z3 execution fails
- **Impact:** SpecInt/SpecNat unbounded arithmetic is non-functional. Two E2E tests commented out with TODO markers in `crates/analysis/tests/e2e_verification.rs`
- **Status:** Present since v0.1 ship. Phase 18 added a separate QF_LIA optimization path (conservative eligibility filter, differential testing) — Phase 18 works correctly — but the underlying `bv2int/int2bv` Z3 issue from Phase 04 remains unfixed
- **Evidence:** `crates/analysis/tests/e2e_verification.rs` lines 1364-1445 and 1449-1523 (commented TODO blocks)

### 2. Phase 04 — Ghost locals filtering incomplete
- **What:** Ghost locals declared in VCGen but not filtered from executable encoding
- **Impact:** Ghost variables may appear in executable VCs where they should be erased
- **Evidence:** `crates/analysis/src/vcgen.rs` line 586: "including ghost locals - they're declared but may not be used in executable VCs"

### 3. VCGEN-06/MIRCONV-02 — SetDiscriminant VC deferred
- **What:** `ir::Statement::SetDiscriminant` variant does not exist; VCGen treats it as no-op
- **Impact:** Match arm discriminant assertion VCs not emitted; `vcgen_06_set_discriminant_assertion` test `#[ignore]`d
- **Context:** Explicitly documented as deferred in Phase 29-01 SUMMARY and Phase 00 UAT. The remaining 2 VCGEN-06 tests (`vcgen_06_struct_field_mutation`, `vcgen_06_field_mutation_use`) pass GREEN.
- **Evidence:** `crates/analysis/tests/vcgen_completeness29.rs` line 600

### 4. Seven phases unverified (no VERIFICATION.md)
Phases 05, 06, 07, 08, 11, 13, 17 have SUMMARY.md files confirming execution but were never formally verified. All are from milestones v0.1–v0.3 (shipped before the VERIFICATION step was established in the GSD workflow). The Phase 00 UAT covers the overall functional behavior of phases 01–27 across 22 test items (all 22 PASS), providing indirect coverage.

---

## Tech Debt by Phase

**Phase 04** (critical)
- Z3 bv2int not working — SpecInt/SpecNat unbounded arithmetic non-functional
- Ghost locals VCGen filtering incomplete/deferred

**Phase 10** (minor)
- Edge cases in raw pointer aliasing noted in verification

**Phase 14** (pending human decision)
- E2E incremental tests ignored (live compiler environment constraint)
- 20-30x speedup not formally confirmed via E2E test (unit benchmarks pass)

**Phase 15** (minor)
- Trigger interaction edge cases with complex quantifier schemas documented but not tested

**Phase 18** (pending human decision)
- Documentation completeness criterion ambiguous: inline help text vs standalone docs/bv2int.md

**Phase 29** (deferred)
- SetDiscriminant VCGen — `vcgen_06_set_discriminant_assertion` test `#[ignore]`d

**Global** (environment constraint)
- 4 incremental E2E tests + 2 benchmark tests ignored (live Rust toolchain constraint)

**Total tech debt items:** ~12 across 6 phases

---

## Workspace Test Health

```
cargo test --workspace: 3,148 passed | 0 failed | ~35 ignored (environment/deferred)
cargo test --doc -p rust-fv-analysis: 1 passed | 0 failed | 28 ignored (correct — rust,ignore fences)
cargo clippy -p rust-fv-analysis: 0 warnings
```

---

## Recommendations

1. **Fix Z3 bv2int** (Phase 04 gap) — determine correct Z3 4.8.10+ function name for bitvector-to-integer conversion; enable the 2 commented E2E tests
2. **Fix ghost locals filtering** (Phase 04 gap) — implement filtering at `encode_assignment` level
3. **Add ir::Statement::SetDiscriminant** (VCGEN-06 deferred) — implement the variant and emit discriminant assertion VCs; un-ignore `vcgen_06_set_discriminant_assertion`
4. **Verify phases 05, 06, 07, 08, 11, 13, 17** — run `/gsd:verify-work` for each unverified early phase to create VERIFICATION.md
5. **Resolve human_needed for phases 14 and 18** — make product decision on documentation requirements

---

*Report generated: 2026-02-26T07:30:00Z*
*Integration checker: 9 E2E flows verified, 12 wiring points confirmed, 3,148 tests GREEN*
