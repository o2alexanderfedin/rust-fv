---
phase: 29.4-stdlib-contracts-option-doc-test-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - crates/analysis/src/stdlib_contracts/option.rs
  - crates/analysis/src/stdlib_contracts/vec.rs
  - crates/analysis/src/stdlib_contracts/result.rs
autonomous: true
requirements: [DOCTEST-FIX-01]

must_haves:
  truths:
    - "cargo test --doc -p rust-fv-analysis reports 0 test failures"
    - "grep -rn '```text' crates/analysis/src/stdlib_contracts/ returns 0 matches"
    - "grep -rn '```rust,ignore' crates/analysis/src/stdlib_contracts/ returns exactly 26 matches"
    - "cargo test -p rust-fv-analysis passes with no regressions"
    - "cargo clippy -p rust-fv-analysis returns no warnings"
  artifacts:
    - path: "crates/analysis/src/stdlib_contracts/option.rs"
      provides: "8 doc blocks changed from ```text to ```rust,ignore"
      contains: "```rust,ignore"
    - path: "crates/analysis/src/stdlib_contracts/vec.rs"
      provides: "9 doc blocks changed from ```text to ```rust,ignore"
      contains: "```rust,ignore"
    - path: "crates/analysis/src/stdlib_contracts/result.rs"
      provides: "9 doc blocks changed from ```text to ```rust,ignore"
      contains: "```rust,ignore"
  key_links:
    - from: "```text fence annotations"
      to: "```rust,ignore fence annotations"
      via: "sed string substitution"
      pattern: "```rust,ignore"
---

<objective>
Fix 26 suppressed doc test blocks in stdlib_contracts by changing ```text to ```rust,ignore.

Purpose: The 26 code blocks document stdlib API signatures (Option, Vec, Result methods). They use ```text which suppresses syntax highlighting and makes them invisible to the doc test harness. The correct annotation is ```rust,ignore — it renders with Rust syntax highlighting and tells the test harness to skip compilation (correct because the signatures reference free type parameters T, F, U that are not in scope in a doc test context).

Output: Three modified files with proper ```rust,ignore annotations, zero ```text occurrences remaining in stdlib_contracts, and 26 new ignored doc tests visible to `cargo test --doc`.
</objective>

<execution_context>
@/Users/alexanderfedin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/alexanderfedin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/29.4-stdlib-contracts-option-doc-test-fixes/29.4-RESEARCH.md

<interfaces>
<!-- The fix is purely textual. No Rust interfaces to extract. -->
<!-- Each of the 26 blocks follows this pattern: -->

Before (WRONG — loses syntax highlighting):
```
/// ```text
/// pub fn method_name<generics>(params) -> ReturnType
/// ```
```

After (CORRECT — Rust syntax highlighting, skip compile):
```
/// ```rust,ignore
/// pub fn method_name<generics>(params) -> ReturnType
/// ```
```

The 26 blocks are split: option.rs (8), vec.rs (9), result.rs (9).
The module-level ```smt blocks in option.rs and result.rs are NOT in the 26 count — leave them untouched.
loader.rs already uses ```ignore (correct) — leave it untouched.
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace all 26 ```text fences with ```rust,ignore</name>
  <files>
    crates/analysis/src/stdlib_contracts/option.rs
    crates/analysis/src/stdlib_contracts/vec.rs
    crates/analysis/src/stdlib_contracts/result.rs
  </files>
  <action>
Apply the string substitution ```` ```text ```` → ```` ```rust,ignore ```` in all three files using sed (macOS syntax requires empty-string suffix `-i ''`):

```bash
cd /Users/alexanderfedin/Projects/hapyy/rust-fv
sed -i '' 's/```text/```rust,ignore/g' crates/analysis/src/stdlib_contracts/option.rs
sed -i '' 's/```text/```rust,ignore/g' crates/analysis/src/stdlib_contracts/vec.rs
sed -i '' 's/```text/```rust,ignore/g' crates/analysis/src/stdlib_contracts/result.rs
```

IMPORTANT constraints:
- Only substitute ```` ```text ```` — do NOT touch ```` ```smt ````, ```` ```ignore ````, ```` ```rust ````, or any other fence annotations.
- The module-level ```` ```smt ```` blocks in option.rs (line 9) and result.rs (line 9) must remain as ```` ```smt ```` — they contain SMT-LIB2 code, not Rust code.
- loader.rs already uses ```` ```ignore ```` (not ```` ```text ````) — do not modify loader.rs.
- After substitution: `grep -rn '```text' crates/analysis/src/stdlib_contracts/` MUST return 0 matches.
- After substitution: `grep -rn '```rust,ignore' crates/analysis/src/stdlib_contracts/` MUST return exactly 26 matches.
  </action>
  <verify>
    <automated>
      cd /Users/alexanderfedin/Projects/hapyy/rust-fv && grep -rn '```text' crates/analysis/src/stdlib_contracts/ | wc -l | tr -d ' ' | grep -q '^0$' && echo "PASS: 0 text blocks remain" && grep -rn '```rust,ignore' crates/analysis/src/stdlib_contracts/ | wc -l | tr -d ' ' | grep -q '^26$' && echo "PASS: exactly 26 rust,ignore blocks"
    </automated>
  </verify>
  <done>
    `grep -rn '```text' crates/analysis/src/stdlib_contracts/` returns 0 lines.
    `grep -rn '```rust,ignore' crates/analysis/src/stdlib_contracts/` returns exactly 26 lines.
    The ```smt blocks in option.rs and result.rs module-level docs are untouched.
  </done>
</task>

<task type="auto">
  <name>Task 2: Run doc tests and unit tests to confirm zero regressions</name>
  <files></files>
  <action>
Run the full verification suite for the analysis crate:

```bash
cd /Users/alexanderfedin/Projects/hapyy/rust-fv

# 1. Clippy — must be clean
cargo clippy -p rust-fv-analysis 2>&1

# 2. Unit tests — must all pass (no regressions)
cargo test -p rust-fv-analysis 2>&1

# 3. Doc tests — must show 26 more ignored, 0 failures
cargo test --doc -p rust-fv-analysis 2>&1
```

Expected doc test output delta:
- Before fix: running 3 tests — 1 passed; 0 failed; 2 ignored
- After fix:  running 29 tests — 1 passed; 0 failed; 28 ignored
  (26 new ignored + 2 pre-existing ignored = 28 ignored total)

If the count is slightly different (e.g., 3 ignored pre-existing), the key invariant is: 0 failures, and ignored count increased by 26 compared to before the fix.

No code logic changes are needed — this is purely a documentation annotation change.
  </action>
  <verify>
    <automated>
      cd /Users/alexanderfedin/Projects/hapyy/rust-fv && cargo test --doc -p rust-fv-analysis 2>&1 | grep -E '(FAILED|error\[)' | wc -l | tr -d ' ' | grep -q '^0$' && echo "PASS: doc tests show 0 failures" && cargo test -p rust-fv-analysis 2>&1 | tail -5
    </automated>
  </verify>
  <done>
    `cargo test --doc -p rust-fv-analysis` passes with 0 failures and shows 26 more ignored tests than before.
    `cargo test -p rust-fv-analysis` passes with 0 failures (no regressions in unit tests).
    `cargo clippy -p rust-fv-analysis` reports no errors or warnings.
  </done>
</task>

</tasks>

<verification>
1. `grep -rn '```text' crates/analysis/src/stdlib_contracts/` returns 0 matches
2. `grep -rn '```rust,ignore' crates/analysis/src/stdlib_contracts/` returns exactly 26 matches
3. `grep -rn '```smt' crates/analysis/src/stdlib_contracts/` still returns 2 matches (option.rs + result.rs module docs untouched)
4. `cargo test --doc -p rust-fv-analysis` shows 0 FAILED
5. `cargo test -p rust-fv-analysis` shows 0 FAILED
6. `cargo clippy -p rust-fv-analysis` shows no errors
</verification>

<success_criteria>
- All 26 ```text occurrences replaced with ```rust,ignore across option.rs (8), vec.rs (9), result.rs (9)
- Zero ```text occurrences remain in crates/analysis/src/stdlib_contracts/
- Zero doc test failures (tests are now marked ignored, not failing)
- Zero unit test regressions
- Zero clippy warnings
- rustdoc renders all 26 blocks with Rust syntax highlighting
</success_criteria>

<output>
After completion, create `.planning/phases/29.4-stdlib-contracts-option-doc-test-fixes/29.4-01-SUMMARY.md` with:
- What was done: 26 ```text → ```rust,ignore substitutions across 3 files
- Verification results: doc test count before/after, grep counts
- Files modified: option.rs (8), vec.rs (9), result.rs (9)
</output>
