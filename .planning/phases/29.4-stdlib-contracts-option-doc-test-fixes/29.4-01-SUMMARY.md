---
phase: 29.4-stdlib-contracts-option-doc-test-fixes
plan: "01"
subsystem: stdlib_contracts
tags: [doc-tests, rust-ignore, option, vec, result, documentation]
dependency_graph:
  requires: []
  provides: [DOCTEST-FIX-01]
  affects: [rust-fv-analysis]
tech_stack:
  added: []
  patterns: ["```rust,ignore for API signature doc blocks"]
key_files:
  created: []
  modified:
    - crates/analysis/src/stdlib_contracts/option.rs
    - crates/analysis/src/stdlib_contracts/vec.rs
    - crates/analysis/src/stdlib_contracts/result.rs
decisions:
  - "Use ```rust,ignore (not ```text) for stdlib API signature doc blocks — renders with Rust syntax highlighting and tells test harness to skip compilation (free type parameters T, F, U not in scope)"
  - "SMT-LIB2 blocks in option.rs and result.rs module docs kept as ```smt — not Rust code"
metrics:
  duration_seconds: 124
  completed_date: "2026-02-26"
  tasks_completed: 2
  files_modified: 3
---

# Phase 29.4 Plan 01: Stdlib Contracts Doc Test Fixes Summary

**One-liner:** Changed 26 `\`\`\`text` doc fences to `\`\`\`rust,ignore` across option.rs (8), vec.rs (9), result.rs (9) — enabling Rust syntax highlighting and exposing 26 ignored tests to the harness.

## What Was Done

Fixed 26 suppressed doc test blocks in `crates/analysis/src/stdlib_contracts/` by changing `\`\`\`text` to `\`\`\`rust,ignore` in three files.

**Root cause:** The 26 code blocks document stdlib API signatures (Option, Vec, Result methods). They used `\`\`\`text` which suppresses syntax highlighting and makes them invisible to the doc test harness. The correct annotation is `\`\`\`rust,ignore` — it renders with Rust syntax highlighting and tells the test harness to skip compilation (correct because the signatures reference free type parameters T, F, U that are not in scope in a doc test context).

### Files Modified

| File | Blocks Changed | Methods |
|------|---------------|---------|
| `crates/analysis/src/stdlib_contracts/option.rs` | 8 | is_some, is_none, unwrap, map, and_then, ok_or, unwrap_or, unwrap_or_else |
| `crates/analysis/src/stdlib_contracts/vec.rs` | 9 | push, pop, len, capacity, get, reserve, shrink_to_fit, is_empty, clear |
| `crates/analysis/src/stdlib_contracts/result.rs` | 9 | is_ok, is_err, unwrap, unwrap_err, map, map_err, and_then, ok, err |

### Untouched

- Module-level `\`\`\`smt` blocks in `option.rs` and `result.rs` — these contain SMT-LIB2 code, not Rust
- `loader.rs` — already uses `\`\`\`ignore` (correct), not modified

## Verification Results

### Grep Counts

| Check | Result |
|-------|--------|
| `grep -rn '\`\`\`text' crates/analysis/src/stdlib_contracts/` | 0 matches |
| `grep -rn '\`\`\`rust,ignore' crates/analysis/src/stdlib_contracts/` | 26 matches |
| `grep -rn '\`\`\`smt' crates/analysis/src/stdlib_contracts/` | 2 matches (untouched) |

### Test Results

**Clippy:** `cargo clippy -p rust-fv-analysis` — Finished with no warnings or errors.

**Doc tests:** `cargo test --doc -p rust-fv-analysis`
- Before fix: running 3 tests — 1 passed; 0 failed; 2 ignored
- After fix: running 29 tests — 1 passed; 0 failed; 28 ignored
- Delta: +26 ignored tests (correct — 26 new rust,ignore blocks now visible to harness)

**Unit tests:** `cargo test -p rust-fv-analysis --tests`
- All test suites: 0 failures, 0 regressions

## Commits

| Task | Commit | Description |
|------|--------|-------------|
| Task 1: Replace 26 fences | c96b396 | fix(29.4-01): replace 26 `\`\`\`text` fences with `\`\`\`rust,ignore` in stdlib_contracts |
| Task 2: Verification | (no code change) | All tests pass, verified via cargo test --doc and cargo test --tests |

## Deviations from Plan

None — plan executed exactly as written. The substitution was already applied (from prior partial execution at commit c96b396); Task 2 verification confirmed all criteria met.

## Self-Check: PASSED

- [x] 0 `\`\`\`text` occurrences in crates/analysis/src/stdlib_contracts/ — VERIFIED
- [x] 26 `\`\`\`rust,ignore` occurrences — VERIFIED
- [x] 2 `\`\`\`smt` occurrences (untouched) — VERIFIED
- [x] doc tests: 1 passed, 0 failed, 28 ignored — VERIFIED
- [x] unit tests: all pass, 0 failures — VERIFIED
- [x] clippy: no warnings — VERIFIED
- [x] Commit c96b396 exists — VERIFIED
