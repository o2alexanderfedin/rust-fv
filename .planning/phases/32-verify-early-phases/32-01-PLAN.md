---
phase: 32-verify-early-phases
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/05-performance-and-polish/05-VERIFICATION.md
  - .planning/phases/06-recursive-functions/06-VERIFICATION.md
  - .planning/phases/07-closures/07-VERIFICATION.md
autonomous: true
requirements: []
must_haves:
  truths:
    - "05-VERIFICATION.md exists in .planning/phases/05-performance-and-polish/ with retrospective frontmatter"
    - "06-VERIFICATION.md exists in .planning/phases/06-recursive-functions/ with retrospective frontmatter"
    - "07-VERIFICATION.md exists in .planning/phases/07-closures/ with retrospective frontmatter"
    - "Each VERIFICATION.md has verbatim cargo test output as evidence"
    - "Each VERIFICATION.md assigns a verdict: PASS, PASS WITH NOTES, or FAIL"
    - "Significant gaps (if any) are documented with fix phase notes"
  artifacts:
    - path: ".planning/phases/05-performance-and-polish/05-VERIFICATION.md"
      provides: "Formal verification record for Phase 05 (formula simplification, diagnostics, JSON output)"
    - path: ".planning/phases/06-recursive-functions/06-VERIFICATION.md"
      provides: "Formal verification record for Phase 06 (recursive functions + termination VCs)"
    - path: ".planning/phases/07-closures/07-VERIFICATION.md"
      provides: "Formal verification record for Phase 07 (closure defunctionalization)"
  key_links:
    - from: "ROADMAP.md phase goal"
      to: "VERIFICATION.md Observable Truths table"
      via: "goal-backward analysis"
      pattern: "Goal Achievement.*Observable Truths"
    - from: "SUMMARY.md deliverables"
      to: "VERIFICATION.md Required Artifacts table"
      via: "deliverable tracing"
      pattern: "Required Artifacts.*Status.*VERIFIED"
---

<objective>
Create retrospective VERIFICATION.md files for Phases 05, 06, and 07 — the three early phases from v0.1 POC and v0.2 Advanced Verification milestones that executed before the verification step was established.

Purpose: Close the audit gap identified in v0.1 milestone audit. These phases are known-working (Phase 00 UAT: 22/22 PASS; 3,148 passing tests), but lack formal verification records.
Output: Three VERIFICATION.md files with full evidence — goal-backward analysis, artifact presence checks, verbatim cargo test output, and verdict.
</objective>

<execution_context>
@/Users/alexanderfedin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/alexanderfedin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

<!-- Phase directories with all PLAN.md and SUMMARY.md files -->
@.planning/phases/05-performance-and-polish/05-01-PLAN.md
@.planning/phases/05-performance-and-polish/05-01-SUMMARY.md
@.planning/phases/05-performance-and-polish/05-02-PLAN.md
@.planning/phases/05-performance-and-polish/05-02-SUMMARY.md
@.planning/phases/05-performance-and-polish/05-03-PLAN.md
@.planning/phases/05-performance-and-polish/05-03-SUMMARY.md
@.planning/phases/06-recursive-functions/06-01-SUMMARY.md
@.planning/phases/06-recursive-functions/06-02-SUMMARY.md
@.planning/phases/06-recursive-functions/06-03-SUMMARY.md
@.planning/phases/07-closures/07-01-SUMMARY.md
@.planning/phases/07-closures/07-02-SUMMARY.md
@.planning/phases/07-closures/07-03-SUMMARY.md

<!-- Canonical format template — match this EXACTLY -->
@.planning/phases/31-z3-bv2int-fix-ghost-locals/31-VERIFICATION.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify Phase 05 (Performance and Polish) and create 05-VERIFICATION.md</name>
  <files>.planning/phases/05-performance-and-polish/05-VERIFICATION.md</files>
  <action>
    **Goal-backward verification for Phase 05:**

    Phase goal (from ROADMAP.md): "Production-ready cargo verify with formula simplification, benchmarks, and diagnostics"

    Milestone: v0.1 POC (shipped 2026-02-12)

    **Step 1: Read all Phase 05 SUMMARY.md files** to extract exact deliverables.
    Key deliverables from research knowledge base:
    - 05-01: `crates/analysis/src/simplify.rs` — `simplify_term()`, `simplify_script()`, constant folding, identity elimination, double negation
    - 05-02: Criterion benchmarks (vcgen_bench.rs, stress_bench.rs) with simplification impact measurement
    - 05-03: `crates/driver/src/diagnostics.rs` (VcKind classification, 10 categories), `crates/driver/src/json_output.rs` (JsonVerificationReport)

    **Step 2: Check artifacts exist** using Read/Grep tools:
    - `crates/analysis/src/simplify.rs` — grep for `pub fn simplify_term` and `pub fn simplify_script`
    - `crates/analysis/tests/simplify_tests.rs` — verify exists
    - `crates/driver/src/diagnostics.rs` — grep for VcKind classification match arms
    - `crates/driver/src/json_output.rs` — grep for `JsonVerificationReport`
    - `crates/analysis/benches/vcgen_bench.rs` or `stress_bench.rs` — verify exists

    **Step 3: Run cargo tests** (paste output verbatim):
    ```
    cd /Users/alexanderfedin/Projects/hapyy/rust-fv
    cargo test -p rust-fv-analysis --test simplify_tests 2>&1
    cargo test -p rust-fv-driver 2>&1 | tail -20
    cargo test --workspace 2>&1 | tail -5
    ```

    **Step 4: Write 05-VERIFICATION.md** following the format in 31-VERIFICATION.md EXACTLY:
    - Frontmatter: `phase: 05-performance-and-polish`, `verified: 2026-02-26T00:00:00Z`, `status: passed`, `score: N/M`, `re_verification: false`, `retrospective: true`, `phase_executed: "2026-02-11 to 2026-02-12"`, `milestone: "v0.1 POC (shipped 2026-02-12)"`
    - Sections: Goal Achievement, Observable Truths (table), Required Artifacts (table), Key Link Verification (table), Requirements Coverage (table), Code Quality / Technical Debt (table), Human Verification Required, Gaps Summary
    - Evidence Log: verbatim cargo test output
    - Retrospective Note: "Phase 05 was executed on 2026-02-11 to 2026-02-12 and shipped in milestone v0.1 POC. This VERIFICATION.md was created retrospectively on 2026-02-26 as part of Phase 32 audit closure. The phase is covered by Phase 00 UAT (22/22 PASS) providing indirect functional coverage."

    Observable Truths to verify:
    1. `simplify.rs` has `pub fn simplify_term(term: &Term) -> Term` and `pub fn simplify_script(script: &Script) -> Script`
    2. Constant folding rules: `And(BoolLit(true), x) -> x`, `BvAdd(BvLit(0,w), x) -> x` implemented
    3. Double negation elimination: `Not(Not(x)) -> x` implemented
    4. `diagnostics.rs` has VcKind match arms for ≥10 diagnostic categories
    5. `json_output.rs` has `JsonVerificationReport` struct
    6. All simplify_tests pass
    7. cargo test --workspace shows 0 failures

    **If the benchmark file doesn't exist:** Note in VERIFICATION.md that benchmarks may have been structured differently — check SUMMARY.md for actual file names.
  </action>
  <verify>
    File `.planning/phases/05-performance-and-polish/05-VERIFICATION.md` exists with:
    - `retrospective: true` in frontmatter
    - Observable Truths table with STATUS column filled in
    - Non-empty Verification Evidence Log section with cargo test output
    - Verdict line stating PASS, PASS WITH NOTES, or FAIL
  </verify>
  <done>05-VERIFICATION.md exists with complete goal-backward analysis, verbatim test output, and verdict</done>
</task>

<task type="auto">
  <name>Task 2: Verify Phase 06 (Recursive Functions) and create 06-VERIFICATION.md</name>
  <files>.planning/phases/06-recursive-functions/06-VERIFICATION.md</files>
  <action>
    **Goal-backward verification for Phase 06:**

    Phase goal (from ROADMAP.md): "Recursive functions with termination proofs via decreases clause"

    Milestone: v0.2 Advanced Verification (shipped 2026-02-14)

    **Step 1: Read all Phase 06 SUMMARY.md files** to extract exact deliverables.
    Key deliverables from research knowledge base:
    - 06-01: `#[decreases(expr)]` proc macro in `crates/macros/src/lib.rs`, `Contracts.decreases: Option<SpecExpr>` field in IR, `VcKind::Termination` variant, `RecursiveGroup` type, `CallGraph::detect_recursion()` via petgraph tarjan_scc
    - 06-02: `crates/analysis/src/recursion.rs` — `encode_recursive_function()`, `check_missing_decreases()`, `generate_termination_vcs()`
    - 06-03: `crates/analysis/tests/recursion_verification.rs` (8 E2E tests via Z3), `format_missing_decreases_help()` and `format_termination_counterexample()` in diagnostics.rs

    **Step 2: Check artifacts exist** using Grep:
    - `crates/macros/src/lib.rs` — grep for `decreases` proc macro definition
    - `crates/analysis/src/ir.rs` — grep for `Contracts` struct with `decreases` field and `VcKind::Termination`
    - `crates/analysis/src/call_graph.rs` — grep for `RecursiveGroup` and `tarjan_scc`
    - `crates/analysis/src/recursion.rs` — grep for `generate_termination_vcs`
    - `crates/analysis/tests/recursion_verification.rs` — verify exists, count tests

    **Step 3: Run cargo tests** (paste verbatim):
    ```
    cd /Users/alexanderfedin/Projects/hapyy/rust-fv
    cargo test -p rust-fv-analysis --test recursion_verification 2>&1
    cargo test -p rust-fv-macros 2>&1 | tail -10
    ```

    **Step 4: Write 06-VERIFICATION.md** following 31-VERIFICATION.md format:
    - Frontmatter: `phase: 06-recursive-functions`, `verified: 2026-02-26T00:00:00Z`, `retrospective: true`, `phase_executed: "2026-02-12 to 2026-02-14"`, `milestone: "v0.2 Advanced Verification (shipped 2026-02-14)"`
    - Full Observable Truths table (check all 7 items above)
    - Key link: `Contracts.decreases` → `generate_termination_vcs()` → `VcKind::Termination`
    - Requirements: REC-01 through REC-05, INF-01

    Observable Truths to verify:
    1. `pub fn decreases` proc macro exists in macros/src/lib.rs
    2. `Contracts` struct has `decreases: Option<SpecExpr>` field
    3. `VcKind::Termination` variant exists in ir.rs
    4. `RecursiveGroup` struct and `tarjan_scc` usage in call_graph.rs
    5. `crates/analysis/src/recursion.rs` exists with `generate_termination_vcs`
    6. `recursion_verification.rs` has ≥8 E2E tests
    7. All recursion_verification tests pass via Z3
  </action>
  <verify>
    File `.planning/phases/06-recursive-functions/06-VERIFICATION.md` exists with:
    - `retrospective: true` in frontmatter
    - Observable Truths table covering decreases macro, VcKind::Termination, recursion.rs
    - Verbatim cargo test output for recursion_verification
    - Verdict stated clearly
  </verify>
  <done>06-VERIFICATION.md exists with complete goal-backward analysis, verbatim test output, and verdict</done>
</task>

<task type="auto">
  <name>Task 3: Verify Phase 07 (Closures) and create 07-VERIFICATION.md</name>
  <files>.planning/phases/07-closures/07-VERIFICATION.md</files>
  <action>
    **Goal-backward verification for Phase 07:**

    Phase goal (from ROADMAP.md): "Fn/FnMut/FnOnce closure verification via defunctionalization"

    Milestone: v0.2 Advanced Verification (shipped 2026-02-14)

    **Step 1: Read all Phase 07 SUMMARY.md files** to extract exact deliverables.
    Key deliverables from research knowledge base:
    - 07-01: `ClosureTrait`, `ClosureInfo`, `closure_analysis` module, SMT encoding (closure environment as datatype, `declare-fun` for closure_impl)
    - 07-02: `crates/analysis/src/defunctionalize.rs` — `defunctionalize_closure_call()`, `encode_closure_call_term()`, FnOnce single-call validation
    - 07-03: `crates/analysis/tests/closure_verification.rs` (10 E2E tests), `format_closure_contract_help()` and `format_fnonce_double_call_help()` in diagnostics.rs

    **Step 2: Check artifacts exist** using Grep:
    - `crates/analysis/src/defunctionalize.rs` — grep for `defunctionalize_closure_call` and `encode_closure_call_term`
    - `crates/analysis/src/closure_analysis.rs` (or equivalent) — grep for `ClosureInfo` and `ClosureTrait`
    - `crates/analysis/tests/closure_verification.rs` — verify exists, count tests
    - `crates/driver/src/diagnostics.rs` — grep for `format_closure_contract_help` and `format_fnonce_double_call_help`

    **Step 3: Run cargo tests** (paste verbatim):
    ```
    cd /Users/alexanderfedin/Projects/hapyy/rust-fv
    cargo test -p rust-fv-analysis --test closure_verification 2>&1
    ```

    **Step 4: Write 07-VERIFICATION.md** following 31-VERIFICATION.md format:
    - Frontmatter: `phase: 07-closures`, `verified: 2026-02-26T00:00:00Z`, `retrospective: true`, `phase_executed: "2026-02-12 to 2026-02-14"`, `milestone: "v0.2 Advanced Verification (shipped 2026-02-14)"`
    - Full Observable Truths table
    - Key link: `defunctionalize_closure_call()` → closure environment as SMT datatype → closure_impl declare-fun
    - Requirements: CLO-01 through CLO-06

    Observable Truths to verify:
    1. `crates/analysis/src/defunctionalize.rs` exists with `defunctionalize_closure_call` and `encode_closure_call_term`
    2. Closure analysis module exists with `ClosureTrait` and `ClosureInfo` types
    3. `closure_verification.rs` has ≥10 E2E tests
    4. FnOnce single-call validation present (grep for `fnonce` logic in defunctionalize.rs)
    5. `format_closure_contract_help` exists in diagnostics.rs
    6. `format_fnonce_double_call_help` exists in diagnostics.rs
    7. All closure_verification tests pass
  </action>
  <verify>
    File `.planning/phases/07-closures/07-VERIFICATION.md` exists with:
    - `retrospective: true` in frontmatter
    - Observable Truths table covering defunctionalize.rs, ClosureTrait, closure_verification tests
    - Verbatim cargo test output for closure_verification
    - Verdict stated clearly
  </verify>
  <done>07-VERIFICATION.md exists with complete goal-backward analysis, verbatim test output, and verdict</done>
</task>

</tasks>

<verification>
All three VERIFICATION.md files exist in their respective phase directories:
- `ls .planning/phases/05-performance-and-polish/05-VERIFICATION.md`
- `ls .planning/phases/06-recursive-functions/06-VERIFICATION.md`
- `ls .planning/phases/07-closures/07-VERIFICATION.md`

Each file has `retrospective: true` in frontmatter:
- `grep "retrospective: true" .planning/phases/05-performance-and-polish/05-VERIFICATION.md`
- `grep "retrospective: true" .planning/phases/06-recursive-functions/06-VERIFICATION.md`
- `grep "retrospective: true" .planning/phases/07-closures/07-VERIFICATION.md`
</verification>

<success_criteria>
Three VERIFICATION.md files created, each with:
- Retrospective frontmatter (retrospective: true, phase_executed date, milestone)
- Observable Truths table with VERIFIED / NOT VERIFIED status per truth
- Required Artifacts table with file presence evidence
- Key Link Verification table
- Verbatim cargo test output in Verification Evidence Log
- Clear verdict (PASS / PASS WITH NOTES / FAIL)
- Gaps Summary section (documenting any issues found)
</success_criteria>

<output>
After completion, create `.planning/phases/32-verify-early-phases/32-01-SUMMARY.md`
</output>
