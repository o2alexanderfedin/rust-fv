---
milestone: v0.6
audited: 2026-02-28
status: gaps_found
scores:
  requirements: 0/7
  phases: 1/4
  integration: 5/7
  flows: 1/2
gaps:
  requirements:
    - id: "ALIAS-01"
      status: "partial"
      phase: "Phase 34"
      claimed_by_plans: ["34-01-PLAN.md", "34-02-PLAN.md"]
      completed_by_plans: ["34-01-SUMMARY.md", "34-02-SUMMARY.md"]
      verification_status: "passed (test harness only)"
      evidence: "Phase VERIFICATION.md passed 11/11. Integration checker found critical driver gap: callbacks.rs line 422 hardcodes alias_preconditions: vec![] and never calls extract_alias_preconditions. The real `cargo verify` path is broken — #[unsafe_requires(!alias(p,q))] has no effect at runtime. Only the test-harness path (manually constructed ContractDatabase) works."
    - id: "ALIAS-02"
      status: "partial"
      phase: "Phase 34"
      claimed_by_plans: ["34-01-PLAN.md", "34-02-PLAN.md"]
      completed_by_plans: ["34-01-SUMMARY.md", "34-02-SUMMARY.md"]
      verification_status: "passed (test harness only)"
      evidence: "Same driver gap as ALIAS-01. Counterexample description format is correctly implemented and tested, but never emitted via real cargo verify because alias_preconditions is always empty in production code path."
    - id: "OPAQUE-01"
      status: "unsatisfied"
      phase: "Phase 35"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 35 not started. No VERIFICATION.md. No implementation."
    - id: "OPAQUE-02"
      status: "unsatisfied"
      phase: "Phase 35"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 35 not started. No VERIFICATION.md. No implementation."
    - id: "OPAQUE-03"
      status: "unsatisfied"
      phase: "Phase 36"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 36 not started. No VERIFICATION.md. No implementation."
    - id: "XCREC-01"
      status: "unsatisfied"
      phase: "Phase 37"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 37 not started. No VERIFICATION.md. No implementation."
    - id: "XCREC-02"
      status: "unsatisfied"
      phase: "Phase 37"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 37 not started. No VERIFICATION.md. No implementation."
  integration:
    - id: "DRIVER-GAP-1"
      description: "callbacks.rs extract_contracts does not parse rust_fv::unsafe_requires::* doc attributes (lines 791-816)"
      affects: ["ALIAS-01", "ALIAS-02"]
      severity: "critical"
      file: "crates/driver/src/callbacks.rs"
      fix: "Add handler branch for rust_fv::unsafe_requires::* parallel to existing rust_fv::requires::* branch at line 791"
    - id: "DRIVER-GAP-2"
      description: "ContractDatabase build loop hardcodes alias_preconditions: vec![] (line 422) instead of calling extract_alias_preconditions"
      affects: ["ALIAS-01", "ALIAS-02"]
      severity: "critical"
      file: "crates/driver/src/callbacks.rs"
      fix: "Replace vec![] with call to extract_alias_preconditions(&ir_func) after DRIVER-GAP-1 is fixed"
    - id: "DRIVER-GAP-3"
      description: "mir_converter.rs convert_mir hardcodes is_unsafe_fn: false and unsafe_contracts: None (lines 144-145)"
      affects: ["ALIAS-01", "ALIAS-02"]
      severity: "critical"
      file: "crates/driver/src/mir_converter.rs"
      fix: "Set is_unsafe_fn and unsafe_contracts from HIR fn declaration; prerequisite for DRIVER-GAP-2"
  flows:
    - name: "real cargo verify with #[unsafe_requires(!alias(p,q))]"
      breaks_at: "callbacks.rs step 3/4 — extract_contracts skips unsafe_requires attributes; alias_preconditions always vec![]"
      affects: ["ALIAS-01", "ALIAS-02"]
tech_debt:
  - phase: 34-cross-function-pointer-aliasing
    items:
      - "DEBTLINE comments at unsafe_verification.rs lines 930/944 for alignment-check VC (unrelated to Phase 34; future phase)"
      - "extract_alias_preconditions only tested via unit tests and manual ContractDatabase construction — no end-to-end test with real MIR conversion"
---

# v0.6 Cross-Crate Verification — Milestone Audit

**Audited:** 2026-02-28
**Status:** ⚠ gaps_found
**Milestone Goal:** Break the "each crate is an island" barrier — cross-function pointer aliasing, opaque callee contract enforcement, and cross-crate mutual recursion detection.

---

## Requirements Coverage (3-Source Cross-Reference)

| Requirement | Description | Phase | VERIFICATION.md | SUMMARY Frontmatter | REQUIREMENTS.md | Final Status |
|-------------|-------------|-------|-----------------|---------------------|-----------------|--------------|
| ALIAS-01 | Inter-procedural alias tracking | 34 | passed (test harness) | listed | `[x]` | **partial** |
| ALIAS-02 | Counterexample naming aliasing pair | 34 | passed (test harness) | listed | `[x]` | **partial** |
| OPAQUE-01 | Diagnostic for uncontracted callee | 35 | missing | missing | `[ ]` | **unsatisfied** |
| OPAQUE-02 | Error for uncontracted unsafe callee | 35 | missing | missing | `[ ]` | **unsatisfied** |
| OPAQUE-03 | Summary contract inference | 36 | missing | missing | `[ ]` | **unsatisfied** |
| XCREC-01 | Cross-crate SCC detection | 37 | missing | missing | `[ ]` | **unsatisfied** |
| XCREC-02 | Cross-crate termination measures | 37 | missing | missing | `[ ]` | **unsatisfied** |

**Score:** 0/7 fully satisfied (2/7 partial, 5/7 unsatisfied)

---

## Phase Execution Status

| Phase | Status | VERIFICATION.md | Requirements |
|-------|--------|-----------------|--------------|
| 34: Cross-Function Pointer Aliasing | ✓ Complete | passed (11/11) | ALIAS-01, ALIAS-02 |
| 35: Opaque Callee Diagnostics | ○ Not started | missing | OPAQUE-01, OPAQUE-02 |
| 36: Summary Contract Inference | ○ Not started | missing | OPAQUE-03 |
| 37: Cross-Crate SCC Detection | ○ Not started | missing | XCREC-01, XCREC-02 |

**Phases:** 1/4 complete | **Unverified (blocker):** phases 35, 36, 37

---

## Critical Integration Gaps (Driver Path Broken)

Phase 34 correctly implements the alias verification analysis layer (spec_parser → heap_model → vcgen → Z3). However, the driver layer (`crates/driver/`) was not updated to wire the analysis into the real `cargo verify` invocation path. All 28 integration tests pass because they construct the `ContractDatabase` manually — bypassing the broken driver path.

### Gap 1: `extract_contracts` skips `unsafe_requires` attributes

**File:** `crates/driver/src/callbacks.rs` lines 791-816
**Issue:** The doc attribute extraction loop handles `rust_fv::requires::*` but has no handler for `rust_fv::unsafe_requires::*`. When a function has `#[unsafe_requires(!alias(p, q))]`, the attribute is silently ignored.
**Fix:** Add a handler branch for `rust_fv::unsafe_requires::*` that calls `extract_unsafe_requires` or equivalent, populating `Function.unsafe_contracts`.

### Gap 2: `alias_preconditions` always empty in `ContractDatabase`

**File:** `crates/driver/src/callbacks.rs` line 422
**Issue:** `FunctionSummary { alias_preconditions: vec![], ... }` is hardcoded. `extract_alias_preconditions` is never called from the driver.
**Fix:** Replace `alias_preconditions: vec![]` with `extract_alias_preconditions(&ir_func)` after Gap 1 is closed.

### Gap 3: `mir_converter.rs` hardcodes `is_unsafe_fn: false`

**File:** `crates/driver/src/mir_converter.rs` lines 144-145
**Issue:** `is_unsafe_fn: false` and `unsafe_contracts: None` are hardcoded, meaning even if Gap 1 is fixed, the IR function passed to `extract_alias_preconditions` would have no `unsafe_contracts` to extract from.
**Fix:** Set `is_unsafe_fn` and `unsafe_contracts` from the HIR function declaration during MIR-to-IR conversion.

### E2E Flow Verification

| Flow | Status | Break Point |
|------|--------|-------------|
| Test harness path (manual ContractDatabase) | ✓ Working | — |
| Real `cargo verify` with `#[unsafe_requires(!alias(p,q))]` | ✗ Broken | callbacks.rs:791-816 (Gap 1) + callbacks.rs:422 (Gap 2) |

---

## Phase 34 Detailed Report

**Status:** passed (test harness), partial (production path)
**Score:** 11/11 must-haves verified (by automated tests)
**Commits:** ed3aeb1 (infrastructure), 0a21994 (call-site injection)

### What Works
- `spec_parser.rs` parses `alias(p, q)` → `Term::Eq`
- `VcKind::PointerAliasing` variant exists and is handled in callbacks.rs + diagnostics.rs
- `AliasPrecondition` struct in `contract_db.rs` carries `param_idx_a`, `param_idx_b`
- `extract_alias_preconditions` in `unsafe_analysis.rs` correctly resolves parameter indices
- `generate_call_site_vcs` in `vcgen.rs` injects alias VCs when `alias_preconditions` is non-empty
- Z3 correctly identifies SAT (aliasing) and returns valid (non-aliasing) in integration tests
- Counterexample description format names the argument pair by index and local name

### What Is Missing (Production Path)
- Driver never calls `extract_alias_preconditions` → `alias_preconditions` is always empty
- `#[unsafe_requires(!alias(p,q))]` has no effect when running real `cargo verify`

### Integration Seams Established for Future Phases

| Future Phase | Seam | Ready |
|---|---|---|
| Phase 35 (OPAQUE) | `check_missing_unsafe_contracts(func)` in `unsafe_analysis.rs:67` | ✓ |
| Phase 35 (OPAQUE) | `VcKind` enum extension point in `vcgen.rs:114` | ✓ |
| Phase 36 (INFER) | `FunctionSummary` carrier in `contract_db.rs:32` | ✓ |
| Phase 37 (XCREC) | `CallGraph` + topological ordering in `call_graph.rs` | ✓ |
| Phase 37 (XCREC) | `Contracts.decreases` in IR for cross-crate termination | ✓ |

---

## Tech Debt

| Phase | Item | Severity |
|-------|------|----------|
| 34 | DEBTLINE comments at `unsafe_verification.rs:930,944` for alignment-check VC | Info |
| 34 | No end-to-end test with real MIR conversion for alias checking | Medium |
| 35 | Not started | — |
| 36 | Not started | — |
| 37 | Not started | — |

---

## Orphaned Requirements

None — all 7 requirements appear in at least one PLAN.md frontmatter (or are assigned to not-yet-started phases).

---

## Summary

The v0.6 milestone is **in progress**, not complete:

- Phase 34 delivered the alias verification analysis infrastructure and is fully tested at the analysis layer
- **However**, a critical driver integration gap means `#[unsafe_requires(!alias(p,q))]` has no effect when users run `cargo verify` — the feature is test-passing but not user-facing
- Phases 35, 36, 37 have not been started (OPAQUE-01/02/03, XCREC-01/02 unsatisfied)

The audit result is **gaps_found** because ALIAS-01 and ALIAS-02 are only partially satisfied (analysis works, driver path broken), and 5 of 7 requirements are entirely unsatisfied.

---

*Audit performed: 2026-02-28*
*Auditor: Claude (gsd orchestrator + gsd-integration-checker)*
