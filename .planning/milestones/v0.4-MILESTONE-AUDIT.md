---
milestone: v0.4
name: Full Rust Verification
audited: 2026-02-23T00:00:00Z
re_audited: 2026-02-23T12:00:00Z
status: tech_debt
scores:
  requirements: 16/16
  phases: 8/8
  integration: 15/16
  flows: 4/5
gaps: {}
tech_debt:
  - phase: 23-async-await
    items:
      - "verifier.ts JsonCounterexample interface missing poll_iteration?: number and await_side?: string fields (present in Rust json_output.rs lines 62-66). ASY counterexamples emit these fields in JSON but IDE cannot reference or render them. Backend verification correct and Z3-validated; gap is IDE rendering fidelity only."
      - "parallel.rs build_counterexample_v2() always constructs poll_iteration: None and await_side: None (lines 414-415). The poll_iter Z3 model value (from cx_pairs) is never extracted and assigned. Fix requires: (1) add 2 optional fields to verifier.ts JsonCounterexample interface, (2) extract poll_iter constant from Z3 model in build_counterexample_v2(), (3) optionally render in outputPanel.ts."
---

# Milestone v0.4: Full Rust Verification — Audit Report

**Audited:** 2026-02-23 (re-audited 2026-02-23 with integration checker)
**Status:** ⚡ tech_debt — All requirements met, no critical blockers, 1 deferred item (2 sub-items)

---

## Milestone Scope

**Goal:** Complete Rust verification coverage — every major language feature verifiable with no exceptions and no compromises. Counterexample generation, separation logic, weak memory models, higher-order closure spec entailments, and async/await functional verification.

**Phases in scope:** 19–26 (8 phases, including 3 gap-closure phases 24/25/26)

**Requirements:** 16 (CEX-01–04, SEP-01–04, WMM-01–04, HOF-01–02, ASY-01–02)

---

## Phase Verification Status

| Phase | Name | Status | Score |
|-------|------|--------|-------|
| 19 | Counterexample Generation | ✓ passed | 4/4 |
| 20 | Separation Logic | ✓ passed | 7/7 |
| 21 | Weak Memory Models | ✓ passed | 14/14 |
| 22 | Higher-Order Closures | ✓ passed | 12/12 |
| 23 | Async/Await | ✓ passed | 13/13 |
| 24 | SEP-04 Ghost Predicate Wiring | ✓ passed | 4/4 |
| 25 | VSCode Counterexample v2 | ✓ passed | 5/5 |
| 26 | WMM-03 Race Detection Fix | ✓ passed | 5/5 |

All 8 phases: VERIFICATION.md present, status = passed, 0 critical gaps.

---

## Requirements Coverage (3-Source Cross-Reference)

| Requirement | VERIFICATION.md | SUMMARY Frontmatter | REQUIREMENTS.md | Final Status |
|-------------|----------------|---------------------|-----------------|--------------|
| CEX-01 | ✓ Ph-19 passed | ✓ Ph-19 | ✓ [x] Complete | **satisfied** |
| CEX-02 | ✓ Ph-19/25 passed | ✓ Ph-25 provides [CEX-02] | ✓ [x] Complete | **satisfied** |
| CEX-03 | ✓ Ph-19 passed | ✓ Ph-19 | ✓ [x] Complete | **satisfied** |
| CEX-04 | ✓ Ph-19/25 passed | ✓ Ph-25 provides [CEX-04] | ✓ [x] Complete | **satisfied** |
| SEP-01 | ✓ Ph-20 passed | ✓ Ph-20 | ✓ [x] Complete | **satisfied** |
| SEP-02 | ✓ Ph-20 passed | ✓ Ph-20 | ✓ [x] Complete | **satisfied** |
| SEP-03 | ✓ Ph-20 passed | ✓ Ph-20 | ✓ [x] Complete | **satisfied** |
| SEP-04 | ✓ Ph-20/24 passed | ✓ Ph-24 provides [SEP-04] | ✓ [x] Complete | **satisfied** |
| WMM-01 | ✓ Ph-21 passed | ✓ Ph-21 | ✓ [x] Complete | **satisfied** |
| WMM-02 | ✓ Ph-21 passed | ✓ Ph-21 | ✓ [x] Complete | **satisfied** |
| WMM-03 | ✓ Ph-21/26 passed | ✓ Ph-26 provides [WMM-03 E2E proof] | ✓ [x] Complete | **satisfied** |
| WMM-04 | ✓ Ph-21 passed | ✓ Ph-21 | ✓ [x] Complete | **satisfied** |
| HOF-01 | ✓ Ph-22 passed | ✓ Ph-22 requirements [HOF-01, HOF-02] | ✓ [x] Complete | **satisfied** |
| HOF-02 | ✓ Ph-22 passed | ✓ Ph-22 requirements [HOF-01, HOF-02] | ✓ [x] Complete | **satisfied** |
| ASY-01 | ✓ Ph-23 passed | ✓ Ph-23 | ✓ [x] Complete | **satisfied** |
| ASY-02 | ✓ Ph-23 passed | ✓ Ph-23 | ✓ [x] Complete | **satisfied** |

**Score: 16/16 requirements satisfied**

**Orphan detection:** 0 orphaned requirements. All 16 present in traceability table and verified in at least one VERIFICATION.md.

**Deferred (out of scope):** SEP-05, WMM-05, HOF-03, ASY-03, ASY-04, SEP-06 — explicitly deferred in REQUIREMENTS.md, not v0.4 scope.

---

## Cross-Phase Integration

**Integration check:** 28 exports verified live against code, 0 orphaned, 1 TypeScript schema gap (non-blocking).

### Connected Exports (Confirmed Wired)

- **CEX pipeline:** `VcOutcome` → `callbacks.rs` line 44-51 → `cex_render::render_counterexample` (parallel.rs:376) → `JsonCounterexample` (parallel.rs:314-322) → `JsonFailure` (callbacks.rs:326)
- **SEP pipeline:** `pts_to` → `spec_parser.rs:750` → `sep_logic::encode_pts_to()` → AUFBV SMT; frame rule: `vcgen.rs:2131-2172`; AUFBV logic: `vcgen.rs:1796`
- **Ghost predicates:** `callbacks.rs:391` extract → Arc at `callbacks.rs:598` → `VerificationTask.ghost_pred_db` (parallel.rs:46) → `generate_vcs_with_db()` (parallel.rs:264) → `parse_spec_expr_with_db()` (vcgen.rs:3186)
- **WMM pipeline:** `generate_rc11_vcs()` (vcgen.rs:3569) → `WeakMemoryRace` VC with `Assert(BoolLit(true))` (rc11.rs:576) → Z3 SAT → `diagnostics.rs:530-534` WeakMemoryRace arm
- **HOF pipeline:** `func.contracts.fn_specs` check (vcgen.rs:741-743) → `hof_vcgen::generate_fn_spec_vcs()` → AUFLIA SMT
- **ASY pipeline:** `generate_async_vcs()` (vcgen.rs:749) → `AsyncPostcondition`/`AsyncStateInvariantSuspend`/`AsyncStateInvariantResume` VcKind → QF_LIA SMT
- **VSCode CEX v2:** `renderCounterexampleLines()` (diagnostics.ts:82) → `outputPanel.ts:116` → `counterexample_v2.variables` mapped through `renderTypedVariable()`

### E2E Flows

| Flow | Pipeline | Status |
|------|----------|--------|
| CEX | VcOutcome → cex_render → ariadne → diagnostics → VSCode | ✓ Complete |
| SEP | pts_to/sep-conj → sep_logic.rs → vcgen.rs → Z3 AUFBV → ghost pred DB | ✓ Complete |
| WMM | atomic ops → generate_rc11_vcs → WeakMemoryRace VC → parallel.rs → diagnostics | ✓ Complete |
| HOF | closure IR → hof_vcgen → Z3 AUFLIA | ✓ Complete |
| ASY backend | async fn → CoroutineInfo → async_vcgen → Z3 QF_LIA | ✓ Complete |
| ASY IDE rendering | JSON poll_iteration/await_side → verifier.ts interface | ⚠ Partial (tech debt) |

### Key Wiring Confirmed

- **SEP-04:** `#[ghost_predicate]` → `callbacks.rs extract_ghost_predicates` → `VerificationTask.ghost_pred_db` (Arc) → `generate_vcs_with_db` → ghost pred expansion depth 3. Phase 24 gap closure confirmed live.
- **WMM-03:** `generate_rc11_vcs` Step J → `Assert(BoolLit(true))` → Z3 SAT → `parallel.rs verified:false` → `diagnostics.rs WeakMemoryRace arm`. Phase 26 gap closure confirmed live.
- **CEX-02/04 IDE:** `renderCounterexampleLines` (diagnostics.ts) → `outputPanel.ts` line 116. Phase 25 gap closure confirmed live.

All 16 requirements touch ≥2 phases or crate boundaries. All integration paths verified except ASY IDE rendering (tech debt).

---

## Tech Debt

### 2 sub-items in 1 area — no critical blockers

**Phase 23 (async-await): TypeScript `JsonCounterexample` interface schema gap + Rust never-populated fields**

**Sub-item 1 — TypeScript interface missing fields**
- **File:** `vscode-extension/src/verifier.ts` lines 39-44
- **Issue:** Missing `poll_iteration?: number` and `await_side?: string` fields. Present in Rust `crates/driver/src/json_output.rs` struct (lines 62-66) but not declared in TypeScript interface.
- **Impact:** `diagnostics.ts` and `outputPanel.ts` cannot access or render async-specific counterexample context.

**Sub-item 2 — Rust side never populates the fields**
- **File:** `crates/driver/src/parallel.rs` lines 414-415
- **Issue:** `build_counterexample_v2()` always constructs `poll_iteration: None, await_side: None`. The `poll_iter` Z3 model value from `cx_pairs` is never extracted and assigned.
- **Impact:** Even if TypeScript interface were fixed, no data would flow through — both ends need the fix.

**Combined fix required:**
1. Add `poll_iteration?: number` and `await_side?: string` to `JsonCounterexample` interface in `verifier.ts`
2. Extract `poll_iter` constant from Z3 model in `parallel.rs` `build_counterexample_v2()`
3. Optionally render in `outputPanel.ts` for async failure display

**Severity:** Non-blocking. Backend verification (ASY-01/ASY-02) is correct and Z3-validated. Async VCs are generated, solved, and errors reported correctly. Only IDE rendering fidelity for async counterexamples is degraded.

---

## Anti-Patterns

All 8 phases scanned. 0 TODO/FIXME/placeholder/unimplemented! markers in modified files. `cargo clippy --workspace -- -D warnings` clean on all Rust phases. `npx tsc --noEmit` passes on VSCode extension.

---

## Conclusion

**v0.4 Full Rust Verification milestone achieved its definition of done.**

All 16 requirements verified across 3 independent sources. All 5 verification pipelines wired end-to-end. Three gap-closure phases (24, 25, 26) resolved the critical wiring gaps identified in the v0.4 audit cycle.

One non-blocking tech-debt area (TypeScript schema alignment + Rust field population for async counterexamples) deferred to v0.5 backlog as a 2-file fix.

---

*Audited: 2026-02-23*
*Re-audited: 2026-02-23 (with gsd-integration-checker)*
*Auditor: Claude (gsd-audit-milestone)*
